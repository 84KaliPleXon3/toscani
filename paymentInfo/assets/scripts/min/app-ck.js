!function(e){"use strict";e.fn.paymentInfo=function(a){var s,n,t,r,i,d="paymentInfo";return t=e.map(["change","blur","keyup","keypress","keydown"],function(e){return e+"."+d}).join(" "),r={visa:/^4/,mc:/^5[1-5]/,amex:/^3(4|7)/,disc:/^6011/},n={getCreditCardType:function(a){var s;return e.each(r,function(e,n){return n.test(a)?(s=e,!1):void 0}),s},matchNumbers:function(a){var s=a.data("ccNumber")||a.val(),t=n.getCreditCardType(s);""!==a.val()?""!==t?a.prev().addClass(t):a.prev().removeClass().addClass(i.cardImageClass):a.prev().removeClass().addClass(i.cardImageClass).data("ccNumber",""),"amex"===t?(a.inputmask({mask:"9999 999999 99999",oncomplete:n.creditCardComplete}),e("."+i.cardCvvClass).inputmask({mask:"9999",oncomplete:n.cvvComplete})):(a.inputmask({mask:"9999 9999 9999 9999",oncomplete:n.creditCardComplete}),e("."+i.cardCvvClass).inputmask({mask:"999",oncomplete:n.cvvComplete})),""===a.val()&&e("."+i.fieldsetClass).find("input:gt(0)").val(""),void 0!==t&&(e(a).parents("."+i.fieldsetClass).removeClass("invalid shake"),e("."+i.cardInstructionClass).removeClass("invalid"))},creditCardComplete:function(){var a=e("."+i.cardNumberClass),s=a.inputmask("unmaskedvalue"),t=n.getCreditCardType(s);return void 0===t?(e(a).parents("."+i.fieldsetClass).addClass("invalid shake"),e("."+i.cardInstructionClass).addClass("invalid"),void n.updateInstruction(i.messageCardNumberError)):(a.bind("saveValues",function(){("amex"===t&&15===s.length||"amex"!==t&&16===s.length)&&a.data("ccNumber",s).val(s.substr(s.length-4,s.length))}),a.addClass("transitioning-out"),setTimeout(function(){a.removeClass("transitioning-out"),Modernizr.touch?a.trigger("saveValues").blur(function(){a.trigger("saveValues")}):a.bind("blur",function(){a.trigger("saveValues")}).blur(),a.addClass("full")},i.animationWait),setTimeout(function(){e("."+i.fieldsetClass).find("input:gt(0)").removeClass("hide")},i.animationWait),e(a).unbind("blur focus click keydown keypress").bind("focus click keydown",function(s){("focus"===s.type||"click"===s.type||s.shiftKey&&9===s.keyCode)&&(n.beginCreditCard(e(a)),n.updateInstruction(i.messageEnterCardNumber))}),void((window.navigator.standalone||!Modernizr.touch)&&(e("."+i.cardExpirationClass).focus().val(e.trim(e("."+i.cardExpirationClass).val())),n.updateInstruction(i.messageExpiration))))},expirationComplete:function(){e("."+i.cardImageClass).addClass("cvv2"),e("."+i.cardExpirationClass).addClass("full").unbind("keydown blur").bind("keydown",function(a){8===a.keyCode&&""===e(this).val()&&(e(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(e("."+i.cardNumberClass).focus(),n.updateInstruction(i.messageEnterCardNumber)))}),(window.navigator.standalone||!Modernizr.touch)&&setTimeout(function(){e("."+i.cardCvvClass).focus(),n.updateInstruction(i.messageCVV)},220),n.updateInstruction(i.messageCVV)},cvvComplete:function(){e("."+i.cardImageClass).removeClass("cvv2"),e("."+i.cardCvvClass).addClass("full").unbind("keydown blur").bind("keydown",function(a){(8===a.keyCode||9===a.keyCode)&&(""===e(this).val()&&(e(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(e("."+i.cardExpirationClass).focus(),n.updateInstruction(i.messageExpiration))),e("."+i.cardImageClass).removeClass("cvv2"))}),(window.navigator.standalone||!Modernizr.touch)&&(e("."+i.cardZipClass).focus(),n.updateInstruction(i.messageZip))},zipComplete:function(){e("."+i.cardZipClass).addClass("full").unbind("keydown blur").bind("keydown",function(a){8===a.keyCode&&""===e(this).val()&&(e(this).removeClass("full"),(window.navigator.standalone||!Modernizr.touch)&&(e("."+i.cardCvvClass).focus(),n.updateInstruction(i.messageCVV)))}).inputmask({mask:"99999"}),e("."+i.fieldsetClass).addClass("valid"),e("."+i.cardInstructionClass).addClass("valid"),n.updateInstruction(i.messageSuccess)},beginCreditCard:function(a){e(a).val(e(a).data("ccNumber")).addClass("transitioning-in"),setTimeout(function(){a.removeClass("transitioning-in full")},150),e(a).unbind("keypress blur").bind("keypress blur",function(s){if(13===s.keyCode||"blur"===s.type){var t=e(a).inputmask("unmaskedvalue"),r=n.getCreditCardType(t);("amex"===r&&15===t.length||"amex"!==r&&16===t.length)&&n.creditCardComplete()}}).unbind("focus click keydown"),e("."+i.fieldsetClass).find("input:gt(0)").addClass("hide")},updateInstruction:function(a){e(".card-instruction").html(a)}},s={init:function(a){return i=e.extend({},e.fn.paymentInfo.defaults,a),e.extend(e.inputmask.defaults,{placeholder:" ",showMaskOnHover:!1,overrideFocus:!0}),this.each(function(){e(this).prepend("<span class='"+i.cardImageClass+"'></span>").find("."+i.cardNumberClass).inputmask({mask:"9999 9999 9999 9999"}).end().find("."+i.cardExpirationClass).inputmask({mask:"m/q",clearIncomplete:!0,oncomplete:n.expirationComplete}).addClass("hide").end().find("."+i.cardCvvClass).inputmask({mask:"999"}).addClass("hide").focus(function(){e("."+i.cardImageClass).addClass("cvv2")}).blur(function(){e("."+i.cardImageClass).removeClass("cvv2")}).end().find("."+i.cardZipClass).inputmask({mask:"99999",oncomplete:n.zipComplete}).addClass("hide").end().find("label").addClass("hide").end().after("<span class='card-instruction'>"+i.messageEnterCardNumber+"</span>"),n.matchNumbers(e(this).find("."+i.cardNumberClass).eq(0))}).unbind("."+d).bind(t,function(){n.matchNumbers(e(this).find("."+i.cardNumberClass).eq(0))})},destroy:function(){return this.unbind("."+d)}},s[a]?s[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?e.error("Method does not exist in plugin"):s.init.apply(this,arguments)},e.fn.paymentInfo.defaults={fieldsetClass:"credit-card-group",cardImageClass:"card-image",cardCvvClass:"card-cvv",cardExpirationClass:"card-expiration",cardZipClass:"card-zip",cardNumberClass:"card-number",cardInstructionClass:"card-instruction",animationWait:600,focusDelay:200,messageEnterCardNumber:"Please enter your credit card number",messageCardNumberError:"Please enter a valid credit card number",messageExpiration:"Please enter your card's expiration month and year",messageExpirationError:"Please enter a valid month and year",messageCVV:"Please enter the three-digit CVV number found on the back of your card",messageCVVAmEx:"Please enter your four-digit CVV number on the front of your card",messageZip:"Please enter your billing zip code",messageSuccess:"Hooray! You've successfully filled out your credit card information."}}(jQuery),$(".credit-card-group").paymentInfo();